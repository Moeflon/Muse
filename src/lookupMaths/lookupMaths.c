/**
 * @file lookupMaths.c
 * @author Vic Degraeve
 * @author Victor-Louis De Gusseme
 */

#include <avr/pgmspace.h>

#include "lookupMaths.h"

static const int16_t sin_table[901] PROGMEM = {
	0,     57,    114,   171,   228,   285,   343,   400,   457,   514,   571,   629,   686,   743,   800,   857,
	914,   972,   1029,  1086,  1143,  1200,  1257,  1314,  1372,  1429,  1486,  1543,  1600,  1657,  1714,  1772,
	1829,  1886,  1943,  2000,  2057,  2114,  2171,  2228,  2285,  2342,  2399,  2456,  2513,  2570,  2627,  2684,
	2741,  2798,  2855,  2912,  2969,  3026,  3083,  3140,  3197,  3254,  3311,  3368,  3425,  3481,  3538,  3595,
	3652,  3709,  3766,  3822,  3879,  3936,  3993,  4050,  4106,  4163,  4220,  4276,  4333,  4390,  4446,  4503,
	4560,  4616,  4673,  4730,  4786,  4843,  4899,  4956,  5012,  5069,  5125,  5182,  5238,  5295,  5351,  5408,
	5464,  5520,  5577,  5633,  5689,  5746,  5802,  5858,  5915,  5971,  6027,  6083,  6139,  6196,  6252,  6308,
	6364,  6420,  6476,  6532,  6588,  6644,  6700,  6756,  6812,  6868,  6924,  6980,  7036,  7092,  7147,  7203,
	7259,  7315,  7370,  7426,  7482,  7538,  7593,  7649,  7704,  7760,  7816,  7871,  7927,  7982,  8037,  8093,
	8148,  8204,  8259,  8314,  8370,  8425,  8480,  8535,  8591,  8646,  8701,  8756,  8811,  8866,  8921,  8976,
	9031,  9086,  9141,  9196,  9251,  9306,  9361,  9415,  9470,  9525,  9580,  9634,  9689,  9744,  9798,  9853,
	9907,  9962,  10016, 10071, 10125, 10179, 10234, 10288, 10342, 10397, 10451, 10505, 10559, 10613, 10667, 10721,
	10775, 10829, 10883, 10937, 10991, 11045, 11099, 11153, 11206, 11260, 11314, 11368, 11421, 11475, 11528, 11582,
	11635, 11689, 11742, 11796, 11849, 11902, 11955, 12009, 12062, 12115, 12168, 12221, 12274, 12327, 12380, 12433,
	12486, 12539, 12592, 12644, 12697, 12750, 12803, 12855, 12908, 12960, 13013, 13065, 13118, 13170, 13222, 13275,
	13327, 13379, 13431, 13484, 13536, 13588, 13640, 13692, 13744, 13796, 13847, 13899, 13951, 14003, 14054, 14106,
	14158, 14209, 14261, 14312, 14364, 14415, 14466, 14518, 14569, 14620, 14671, 14722, 14773, 14824, 14875, 14926,
	14977, 15028, 15079, 15130, 15180, 15231, 15282, 15332, 15383, 15433, 15484, 15534, 15584, 15635, 15685, 15735,
	15785, 15835, 15885, 15935, 15985, 16035, 16085, 16135, 16184, 16234, 16284, 16333, 16383, 16433, 16482, 16531,
	16581, 16630, 16679, 16728, 16778, 16827, 16876, 16925, 16974, 17023, 17071, 17120, 17169, 17218, 17266, 17315,
	17363, 17412, 17460, 17509, 17557, 17605, 17653, 17702, 17750, 17798, 17846, 17894, 17942, 17989, 18037, 18085,
	18132, 18180, 18228, 18275, 18323, 18370, 18417, 18465, 18512, 18559, 18606, 18653, 18700, 18747, 18794, 18841,
	18887, 18934, 18981, 19027, 19074, 19120, 19167, 19213, 19259, 19306, 19352, 19398, 19444, 19490, 19536, 19582,
	19628, 19673, 19719, 19765, 19810, 19856, 19901, 19947, 19992, 20037, 20083, 20128, 20173, 20218, 20263, 20308,
	20353, 20397, 20442, 20487, 20531, 20576, 20620, 20665, 20709, 20753, 20798, 20842, 20886, 20930, 20974, 21018,
	21062, 21105, 21149, 21193, 21236, 21280, 21323, 21367, 21410, 21453, 21497, 21540, 21583, 21626, 21669, 21712,
	21754, 21797, 21840, 21882, 21925, 21967, 22010, 22052, 22094, 22137, 22179, 22221, 22263, 22305, 22347, 22388,
	22430, 22472, 22513, 22555, 22596, 22638, 22679, 22720, 22761, 22802, 22844, 22884, 22925, 22966, 23007, 23048,
	23088, 23129, 23169, 23210, 23250, 23290, 23330, 23371, 23411, 23451, 23491, 23530, 23570, 23610, 23649, 23689,
	23728, 23768, 23807, 23846, 23886, 23925, 23964, 24003, 24042, 24080, 24119, 24158, 24196, 24235, 24273, 24312,
	24350, 24388, 24427, 24465, 24503, 24541, 24578, 24616, 24654, 24692, 24729, 24767, 24804, 24841, 24879, 24916,
	24953, 24990, 25027, 25064, 25100, 25137, 25174, 25210, 25247, 25283, 25320, 25356, 25392, 25428, 25464, 25500,
	25536, 25572, 25608, 25643, 25679, 25714, 25750, 25785, 25820, 25855, 25891, 25926, 25960, 25995, 26030, 26065,
	26099, 26134, 26168, 26203, 26237, 26271, 26305, 26339, 26373, 26407, 26441, 26475, 26509, 26542, 26576, 26609,
	26642, 26676, 26709, 26742, 26775, 26808, 26841, 26873, 26906, 26939, 26971, 27004, 27036, 27068, 27100, 27133,
	27165, 27197, 27228, 27260, 27292, 27323, 27355, 27386, 27418, 27449, 27480, 27511, 27542, 27573, 27604, 27635,
	27666, 27696, 27727, 27757, 27787, 27818, 27848, 27878, 27908, 27938, 27968, 27998, 28027, 28057, 28086, 28116,
	28145, 28174, 28203, 28233, 28261, 28290, 28319, 28348, 28377, 28405, 28434, 28462, 28490, 28518, 28547, 28575,
	28603, 28630, 28658, 28686, 28713, 28741, 28768, 28796, 28823, 28850, 28877, 28904, 28931, 28958, 28985, 29011,
	29038, 29064, 29091, 29117, 29143, 29169, 29195, 29221, 29247, 29273, 29298, 29324, 29349, 29375, 29400, 29425,
	29450, 29475, 29500, 29525, 29550, 29575, 29599, 29624, 29648, 29672, 29696, 29721, 29745, 29769, 29792, 29816,
	29840, 29863, 29887, 29910, 29934, 29957, 29980, 30003, 30026, 30049, 30072, 30094, 30117, 30139, 30162, 30184,
	30206, 30228, 30250, 30272, 30294, 30316, 30338, 30359, 30381, 30402, 30423, 30444, 30465, 30486, 30507, 30528,
	30549, 30570, 30590, 30611, 30631, 30651, 30671, 30691, 30711, 30731, 30751, 30771, 30790, 30810, 30829, 30849,
	30868, 30887, 30906, 30925, 30944, 30963, 30981, 31000, 31018, 31037, 31055, 31073, 31091, 31109, 31127, 31145,
	31163, 31180, 31198, 31215, 31233, 31250, 31267, 31284, 31301, 31318, 31335, 31351, 31368, 31384, 31401, 31417,
	31433, 31449, 31465, 31481, 31497, 31513, 31528, 31544, 31559, 31575, 31590, 31605, 31620, 31635, 31650, 31665,
	31679, 31694, 31708, 31723, 31737, 31751, 31765, 31779, 31793, 31807, 31821, 31834, 31848, 31861, 31874, 31888,
	31901, 31914, 31927, 31940, 31952, 31965, 31977, 31990, 32002, 32014, 32026, 32039, 32050, 32062, 32074, 32086,
	32097, 32109, 32120, 32131, 32142, 32154, 32164, 32175, 32186, 32197, 32207, 32218, 32228, 32238, 32249, 32259,
	32269, 32279, 32288, 32298, 32308, 32317, 32327, 32336, 32345, 32354, 32363, 32372, 32381, 32389, 32398, 32407,
	32415, 32423, 32431, 32440, 32448, 32456, 32463, 32471, 32479, 32486, 32494, 32501, 32508, 32515, 32522, 32529,
	32536, 32543, 32549, 32556, 32562, 32569, 32575, 32581, 32587, 32593, 32599, 32604, 32610, 32616, 32621, 32626,
	32632, 32637, 32642, 32647, 32652, 32656, 32661, 32665, 32670, 32674, 32679, 32683, 32687, 32691, 32694, 32698,
	32702, 32705, 32709, 32712, 32715, 32719, 32722, 32725, 32727, 32730, 32733, 32735, 32738, 32740, 32742, 32744,
	32747, 32748, 32750, 32752, 32754, 32755, 32757, 32758, 32759, 32760, 32762, 32762, 32763, 32764, 32765, 32765,
	32766, 32766, 32766, 32766, 32767
};

static const uint16_t squares_table[256] PROGMEM = {
	0,     1,     4,     9,     16,    25,    36,    49,
	64,    81,    100,   121,   144,   169,   196,   225,
	256,   289,   324,   361,   400,   441,   484,   529,
	576,   625,   676,   729,   784,   841,   900,   961,
	1024,  1089,  1156,  1225,  1296,  1369,  1444,  1521,
	1600,  1681,  1764,  1849,  1936,  2025,  2116,  2209,
	2304,  2401,  2500,  2601,  2704,  2809,  2916,  3025,
	3136,  3249,  3364,  3481,  3600,  3721,  3844,  3969,
	4096,  4225,  4356,  4489,  4624,  4761,  4900,  5041,
	5184,  5329,  5476,  5625,  5776,  5929,  6084,  6241,
	6400,  6561,  6724,  6889,  7056,  7225,  7396,  7569,
	7744,  7921,  8100,  8281,  8464,  8649,  8836,  9025,
	9216,  9409,  9604,  9801,  10000, 10201, 10404, 10609,
	10816, 11025, 11236, 11449, 11664, 11881, 12100, 12321,
	12544, 12769, 12996, 13225, 13456, 13689, 13924, 14161,
	14400, 14641, 14884, 15129, 15376, 15625, 15876, 16129,
	16384, 16641, 16900, 17161, 17424, 17689, 17956, 18225,
	18496, 18769, 19044, 19321, 19600, 19881, 20164, 20449,
	20736, 21025, 21316, 21609, 21904, 22201, 22500, 22801,
	23104, 23409, 23716, 24025, 24336, 24649, 24964, 25281,
	25600, 25921, 26244, 26569, 26896, 27225, 27556, 27889,
	28224, 28561, 28900, 29241, 29584, 29929, 30276, 30625,
	30976, 31329, 31684, 32041, 32400, 32761, 33124, 33489,
	33856, 34225, 34596, 34969, 35344, 35721, 36100, 36481,
	36864, 37249, 37636, 38025, 38416, 38809, 39204, 39601,
	40000, 40401, 40804, 41209, 41616, 42025, 42436, 42849,
	43264, 43681, 44100, 44521, 44944, 45369, 45796, 46225,
	46656, 47089, 47524, 47961, 48400, 48841, 49284, 49729,
	50176, 50625, 51076, 51529, 51984, 52441, 52900, 53361,
	53824, 54289, 54756, 55225, 55696, 56169, 56644, 57121,
	57600, 58081, 58564, 59049, 59536, 60025, 60516, 61009,
	61504, 62001, 62500, 63001, 63504, 64009, 64516, 65025
};

static const int16_t arctan_table_1[1025] PROGMEM = {
	0,   1,   2,   3,   4,   5,   6,   7,   8,   10,  11,  12,  13,  14,  15,  16,
	17,  19,  20,  21,  22,  23,  24,  25,  26,  27,  29,  30,  31,  32,  33,  34,
	35,  36,  37,  39,  40,  41,  42,  43,  44,  45,  46,  48,  49,  50,  51,  52,
	53,  54,  55,  56,  57,  59,  60,  61,  62,  63,  64,  65,  66,  67,  69,  70,
	71,  72,  73,  74,  75,  76,  77,  78,  80,  81,  82,  83,  84,  85,  86,  87,
	88,  89,  90,  92,  93,  94,  95,  96,  97,  98,  99,  100, 101, 102, 104, 105,
	106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122,
	123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 134, 135, 136, 137, 138, 139,
	140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 155, 156,
	157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172,
	173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188,
	189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204,
	205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220,
	221, 222, 223, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235,
	236, 237, 238, 239, 240, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250,
	251, 252, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 262, 263, 264,
	265, 266, 267, 268, 269, 270, 270, 271, 272, 273, 274, 275, 276, 277, 278, 278,
	279, 280, 281, 282, 283, 284, 285, 285, 286, 287, 288, 289, 290, 291, 291, 292,
	293, 294, 295, 296, 296, 297, 298, 299, 300, 301, 302, 302, 303, 304, 305, 306,
	306, 307, 308, 309, 310, 311, 311, 312, 313, 314, 315, 316, 316, 317, 318, 319,
	320, 320, 321, 322, 323, 324, 324, 325, 326, 327, 328, 328, 329, 330, 331, 331,
	332, 333, 334, 335, 335, 336, 337, 338, 338, 339, 340, 341, 342, 342, 343, 344,
	345, 345, 346, 347, 348, 348, 349, 350, 351, 351, 352, 353, 354, 354, 355, 356,
	357, 357, 358, 359, 360, 360, 361, 362, 362, 363, 364, 365, 365, 366, 367, 367,
	368, 369, 370, 370, 371, 372, 372, 373, 374, 375, 375, 376, 377, 377, 378, 379,
	379, 380, 381, 382, 382, 383, 384, 384, 385, 386, 386, 387, 388, 388, 389, 390,
	390, 391, 392, 392, 393, 394, 394, 395, 396, 396, 397, 398, 398, 399, 400, 400,
	401, 402, 402, 403, 404, 404, 405, 406, 406, 407, 408, 408, 409, 409, 410, 411,
	411, 412, 413, 413, 414, 415, 415, 416, 416, 417, 418, 418, 419, 419, 420, 421,
	421, 422, 423, 423, 424, 424, 425, 426, 426, 427, 427, 428, 429, 429, 430, 430,
	431, 432, 432, 433, 433, 434, 435, 435, 436, 436, 437, 438, 438, 439, 439, 440,
	440, 441, 442, 442, 443, 443, 444, 444, 445, 446, 446, 447, 447, 448, 448, 449,
	449, 450, 451, 451, 452, 452, 453, 453, 454, 454, 455, 456, 456, 457, 457, 458,
	458, 459, 459, 460, 460, 461, 462, 462, 463, 463, 464, 464, 465, 465, 466, 466,
	467, 467, 468, 468, 469, 469, 470, 471, 471, 472, 472, 473, 473, 474, 474, 475,
	475, 476, 476, 477, 477, 478, 478, 479, 479, 480, 480, 481, 481, 482, 482, 483,
	483, 484, 484, 485, 485, 486, 486, 487, 487, 488, 488, 489, 489, 490, 490, 490,
	491, 491, 492, 492, 493, 493, 494, 494, 495, 495, 496, 496, 497, 497, 498, 498,
	498, 499, 499, 500, 500, 501, 501, 502, 502, 503, 503, 504, 504, 504, 505, 505,
	506, 506, 507, 507, 508, 508, 508, 509, 509, 510, 510, 511, 511, 512, 512, 512,
	513, 513, 514, 514, 515, 515, 516, 516, 516, 517, 517, 518, 518, 519, 519, 519,
	520, 520, 521, 521, 521, 522, 522, 523, 523, 524, 524, 524, 525, 525, 526, 526,
	526, 527, 527, 528, 528, 529, 529, 529, 530, 530, 531, 531, 531, 532, 532, 533,
	533, 533, 534, 534, 535, 535, 535, 536, 536, 536, 537, 537, 538, 538, 538, 539,
	539, 540, 540, 540, 541, 541, 542, 542, 542, 543, 543, 543, 544, 544, 545, 545,
	545, 546, 546, 546, 547, 547, 548, 548, 548, 549, 549, 549, 550, 550, 551, 551,
	551, 552, 552, 552, 553, 553, 553, 554, 554, 555, 555, 555, 556, 556, 556, 557,
	557, 557, 558, 558, 558, 559, 559, 559, 560, 560, 561, 561, 561, 562, 562, 562,
	563, 563, 563, 564, 564, 564, 565, 565, 565, 566, 566, 566, 567, 567, 567, 568,
	568, 568, 569, 569, 569, 570, 570, 570, 571, 571, 571, 572, 572, 572, 573, 573,
	573, 574, 574, 574, 575, 575, 575, 576, 576, 576, 577, 577, 577, 577, 578, 578,
	578, 579, 579, 579, 580, 580, 580, 581, 581, 581, 582, 582, 582, 583, 583, 583,
	583, 584, 584, 584, 585, 585, 585, 586, 586, 586, 586, 587, 587, 587, 588, 588,
	588, 589, 589, 589, 589, 590, 590, 590, 591, 591, 591, 592, 592, 592, 592, 593,
	593, 593, 594, 594, 594, 594, 595, 595, 595, 596, 596, 596, 596, 597, 597, 597,
	598, 598, 598, 598, 599, 599, 599, 600, 600, 600, 600, 601, 601, 601, 601, 602,
	602, 602, 603, 603, 603, 603, 604, 604, 604, 605, 605, 605, 605, 606, 606, 606,
	606, 607, 607, 607, 607, 608, 608, 608, 609, 609, 609, 609, 610, 610, 610, 610,
	611, 611, 611, 611, 612, 612, 612, 612, 613, 613, 613, 613, 614, 614, 614, 615,
	615, 615, 615, 616, 616, 616, 616, 617, 617, 617, 617, 618, 618, 618, 618, 619,
	619, 619, 619, 620, 620, 620, 620, 621, 621, 621, 621, 621, 622, 622, 622, 622,
	623, 623, 623, 623, 624, 624, 624, 624, 625, 625, 625, 625, 626, 626, 626, 626,
	627, 627, 627, 627, 627, 628, 628, 628, 628, 629, 629, 629, 629, 630, 630, 630,
	630, 630, 631, 631, 631, 631, 632, 632, 632, 632, 633, 633, 633, 633, 633, 634,
	634
};

static const int16_t arctan_table_2[129] PROGMEM = {
	634, 636, 637, 639, 641, 643, 644, 646, 647, 649, 651, 652, 654, 655, 657, 658,
	660, 661, 663, 664, 666, 667, 668, 670, 671, 673, 674, 675, 676, 678, 679, 680,
	681, 683, 684, 685, 686, 687, 689, 690, 691, 692, 693, 694, 695, 696, 698, 699,
	700, 701, 702, 703, 704, 705, 706, 707, 708, 709, 710, 711, 712, 712, 713, 714,
	715, 716, 717, 718, 719, 720, 720, 721, 722, 723, 724, 725, 725, 726, 727, 728,
	728, 729, 730, 731, 732, 732, 733, 734, 734, 735, 736, 737, 737, 738, 739, 739,
	740, 741, 741, 742, 743, 743, 744, 745, 745, 746, 747, 747, 748, 748, 749, 750,
	750, 751, 751, 752, 753, 753, 754, 754, 755, 755, 756, 756, 757, 758, 758, 759,
	759
};
static const int16_t arctan_table_3[65] PROGMEM = {
	759, 761, 763, 765, 767, 769, 771, 773, 774, 776, 777, 779, 781, 782, 784, 785,
	786, 788, 789, 790, 792, 793, 794, 795, 796, 798, 799, 800, 801, 802, 803, 804,
	805, 806, 807, 808, 809, 809, 810, 811, 812, 813, 814, 814, 815, 816, 817, 817,
	818, 819, 820, 820, 821, 822, 822, 823, 824, 824, 825, 825, 826, 827, 827, 828,
	828
};

static const int16_t arctan_table_4[33] PROGMEM = {
	805, 809, 814, 817, 821, 824, 827, 830, 832, 835, 837, 839, 841, 843, 844, 846,
	848, 849, 850, 852, 853, 854, 855, 856, 857, 858, 859, 860, 861, 862, 862, 863,
	864
};

static const int16_t arctan_table_5[17] PROGMEM = {
	864, 866, 868, 869, 871, 872, 873, 875, 876, 877, 877, 878, 879, 880, 880, 881,
	882
};

static const int16_t arctan_table_6[9] PROGMEM = {
	882, 884, 885, 886, 888, 888, 889, 890, 891
};

inline int16_t lu_sin(int16_t angle) {
	int sign = 1;
	if(angle < 0) {
		angle = -angle;
		sign = -1;
	}
	if(angle > 900 && angle <= 1800) {
		angle = 1800 - angle;
	}
	else if(angle > 1800) {
		angle -= 1800;
		sign = -1;
	}
	return sign * pgm_read_word(&(sin_table[angle]));
}

inline int16_t lu_cos(int16_t angle) {
	return lu_sin(900 - angle);
}

inline uint8_t lu_sqrt(uint16_t x) {
  const uint16_t* s = squares_table;
  if(pgm_read_word(&(s[128])) <= x) s += 128;
  if(pgm_read_word(&(s[64])) <= x) s += 64;
  if(pgm_read_word(&(s[32])) <= x) s += 32;
  if(pgm_read_word(&(s[16])) <= x) s += 16;
  if(pgm_read_word(&(s[8])) <= x) s += 8;
  if(pgm_read_word(&(s[4])) <= x) s += 4;
  if(pgm_read_word(&(s[2])) <= x) s += 2;
  if(pgm_read_word(&(s[1])) <= x) s += 1;

  return s - squares_table;
}

uint16_t lu_sqrt32(uint32_t x) {
  if(x <= UINT16_MAX) return lu_sqrt(x);
	if(x <= 262143) return lu_sqrt(x >> 2) << 1;
	if(x <= 1048575) return lu_sqrt(x >> 4) << 2;
	if(x <= 4194303) return lu_sqrt(x >> 6) << 3;
	if(x <= 16777215) return lu_sqrt(x >> 8) << 4;
	if(x <= 67108863) return lu_sqrt(x >> 10) << 5;
	if(x <= 268435455) return lu_sqrt(x >> 12) << 6;
	if(x <= 1073741823) return lu_sqrt(x >> 14) << 7;
	if(x <= UINT32_MAX) return lu_sqrt(x >> 16) << 8;

	return UINT16_MAX;
}

int16_t lu_arctan(int16_t n, int16_t d) {
	/* Rare, but here for completeness and to prevent divisions by zero */
	if(d == 0) {
		if(n >= 0) return 900;
		else return -900;
	}

	/* Makes n and d positive, but saves the original signs for later */
	int8_t n_sign = 1;
	int8_t d_sign = 1;

	if(n < 0) {
		n_sign = -1;
		n *= -1;
	}

	if(d < 0) {
		d_sign = -1;
		d *= -1;
	}

 	int16_t angle;

	/* These only return positive angles */
  if((n >> 1) < d) angle = pgm_read_word(&(arctan_table_1[(((int32_t) n) << 9) / d]));
	else if((n >> 2) < d)	angle = pgm_read_word(&(arctan_table_2[(((int32_t) n) << 6) / d - 128]));
	else if((n >> 3) < d)	angle = pgm_read_word(&(arctan_table_3[(((int32_t) n) << 4) / d - 64]));
	else if((n >> 4) < d)	angle = pgm_read_word(&(arctan_table_4[(((int32_t) n) << 2) / d - 32]));
	else if((n >> 5) < d)	angle = pgm_read_word(&(arctan_table_5[(n / d) - 16]));
	else if((n >> 6) < d) angle = pgm_read_word(&(arctan_table_6[((n / d) >> 2) - 8]));
	else angle = 900; /* Pi/2 */

	/* Set correct sign for angle */
	angle *= n_sign * d_sign;

	/* Add pi or -pi to the arctan when denominator is negative */
	if(d_sign == -1) angle += 1800 * n_sign;

	return angle;
}
